/*! peach-templating-engine 2015-10-26 */

function Peach(options){var settings={_protected:{register:true,store:{},on:{node:{},render:{},"var":{}},model:{},dataBinding:{},variable:/\{\{([a-zA-Z0-9_\.]+)\}\}/g,template:/<x-peach(?:\s+)render=(?:\"|\')([^\]]+?)(?:\"|\')><\/x-peach>/g,tagName:"peach",attr:{href:{value:"href"},"class":{value:"class",process:function(value){if(Array.isArray(value)){return value.join(" ")}else if(typeof value==="string"){return value}return""}},style:{value:"style",process:function(value){var style=[];if(typeof value==="string"){return value}for(var k in value){style.push(k+": "+value[k])}return style.join("; ")}},id:{value:"id"},"for":{value:"for"},name:{value:"name"},type:{value:"type"},value:{value:"value"},checked:{value:"checked"},tabindex:{value:"tabindex"},title:{value:"title"},placeholder:{value:"placeholder"},selected:{value:"selected"},disabled:{value:"disabled"}},styles:window.getComputedStyle(document.body),unsafe:["_compose","addClass","class","css","hasClass","object","objectName","parent","removeClass","self","string","style","set","get","tag","jquery"]}};_.merge(settings._protected,options);if(!/^x-/.test(settings._protected.tagName)){settings._protected.tagName="x-"+settings._protected.tagName}if(settings._protected.register){if(typeof document.registerElement==="function"){document.registerElement(settings._protected.tagName,{prototype:Object.create(HTMLElement.prototype),"extends":"div"})}else if(typeof document.register==="function"){document.register(settings._protected.tagName,{prototype:Object.create(HTMLElement.prototype)})}}return Peach.fn.compose(settings,Peach.fn)}Peach.exception=function(error){return"Peach error: "+error};Peach.exeProperties=function(){var args=[];for(var i=1,len=arguments.length;i<len;i++){args.push(arguments[i])}for(var k in arguments[0]){if(typeof arguments[0][k]==="function"){arguments[0][k].apply(this,args)}}};Peach.fn={};Peach.get=function(object){var path=[].slice.call(arguments,1,arguments.length).join(".");return _.get(object,path)};(function(){var namePattern=/^[a-zA-Z0-9\-\_\.]+/;var callerPattern=/:[a-zA-Z0-9\-\_\.:]+/;var objectPattern=/@[a-zA-Z0-9\_\.@]+/;function getArgs(string){var nameMatch=string.match(namePattern);var callerMatch=string.match(callerPattern);var objectMatch=string.match(objectPattern);var _arguments={caller:[],render:string};if(!!nameMatch&&typeof this._protected.store[nameMatch[0]]!=="undefined"){_arguments.name=nameMatch[0];if(!!callerMatch){_arguments.caller=callerMatch[0].substring(1,callerMatch[0].length).split(":")}_arguments.caller.has=function(){for(var i=0,n=arguments.length;i<n;i++){if(_arguments.caller.indexOf(arguments[i])<0){return false}}return true};if(!!objectMatch){_arguments.object=objectMatch[0].substring(1,objectMatch[0].length)}}else{_arguments.name=string}return _arguments}Peach.getArguments=function(){var args=[].slice.call(arguments);var _arguments={};if(typeof args[0]==="object"){_arguments=args[0]}else{_arguments=getArgs.call(this,args[0])}if(typeof _arguments.object==="string"){_arguments.objectName=_arguments.object;_arguments.object=_.cloneDeep(this.get(_arguments.object));if(typeof _arguments.object==="undefined"){_arguments.objectName=false}}else if(typeof _arguments.object==="undefined"){_arguments.object={}}if(typeof args[1]==="object"){_arguments.object=_.assign(args[1],_arguments.object)}if(typeof _arguments.object==="undefined"){throw Peach.exception("Rendering of '"+_arguments.render+"' failed because the object is 'undefined'.")}else if(_arguments.object===window){throw Peach.exception("Rendering of '"+_arguments.render+"' failed because the object passed is 'window'")}if(typeof this._protected.store[_arguments.name]==="object"){_arguments.object.string=this._protected.store[_arguments.name].value;_arguments.object.self=_arguments.name;if(typeof _arguments.object.class==="undefined"){_arguments.object.class=[]}else if(typeof _arguments.object.class==="string"){_arguments.object.class=_arguments.object.class.split(" ")}if(_arguments.object.class.indexOf(_arguments.object.self)<0){_arguments.object.class.push(_arguments.object.self)}}else{_arguments.object.string=_arguments.name;_arguments.object.self=_arguments.object.self||"template"}return _arguments}})();Peach.isNodeList=function(nodes){var str=Object.prototype.toString.call(nodes),nodeList=/^\[object (HTMLCollection|NodeList)\]$/.test(str),len=nodes.hasOwnProperty("length"),nodeHas=len&&typeof nodes[0]==="object"&&nodes[0].nodeType&&nodes[0].nodeType>0,out;if(nodeHas){return true}else if(nodeList&&len){return true}else{return false}};Peach.objectIsValid=function(o){return o!==null&&typeof o==="object"&&o!==window&&typeof o.jquery==="undefined"&&!(o instanceof HTMLElement)&&o.view!==window};Peach.prototype={array:{},object:{},string:{},number:{}};(function(Peach){Peach.set=function(){var model=arguments[0],value=_.last(arguments),target=Array.prototype.slice.call(arguments,1,arguments.length-1).join("."),getTarget=_.get(target);if(["function","object"].indexOf(typeof getTarget)===-1){return _.set(model,target,value)}return _.set(model,target,_.assign(value,getTarget))}})(Peach);(function(){var routerKeys=false;function removeHtml(s){return s.toString().replace(/<[^>]+>/g,"")}function getName(settings,name){var attrName=settings.router[name];return typeof attrName==="object"?attrName.value:_.kebabCase(name)}function getValue(settings,attrName,attrValue){var attrRouter=settings.router[attrName];var attrProcess=typeof attrRouter==="object"?attrRouter.process:false;if(typeof attrProcess==="function"){attrValue=attrProcess(attrValue)}else if(typeof attrValue!=="undefined"){return attrValue.toString()}if(typeof attrValue==="string"&&attrValue.length){return attrValue}return false}function setAttr(options,settings){var out=[];_.forEach(settings.attr,function(attrValue,attrName){var name=getName(settings,attrName);var value=getValue(settings,attrName,attrValue);var render=name+'="'+removeHtml(value)+'"';if(value){options["attr_"+attrName]=render;out.push(render)}});options.attr=out.join(" ")}Peach.setAttr=function(options){var router=this._protected.attr;var attr=_.pick(options,function(a,k){return typeof router[k]==="object"||/^data/.test(k)});if(!routerKeys){routerKeys=_.keys(router)}var settings={router:router,routerKeys:routerKeys,attr:attr,list:{},attrKeys:_.keys(attr).sort(function(a,b){if(routerKeys.indexOf(a)>routerKeys.indexOf(b)){return 1}return-1})};setAttr(options,settings)}})();Peach.fn.tools=function(target){var self=this;var tools={};if(typeof target.class==="undefined"){target.class=[]}else if(typeof target.class==="string"){target.class=target.class.split(" ")}for(var k in Peach.fn.tools){tools[k]=function(k){return function(){var args=Array.prototype.slice.call(arguments);args.unshift(target);return Peach.fn.tools[k].apply(self,args)}}(k)}return tools};Peach.fn.add=function(arg){function string(){var names=arg.match(/^[a-zA-Z0-9\-\_\:\.]+/gm)||[];var groups=arg.split(/^[a-zA-Z0-9\-\_\:\.]+/gm)||[];var _this=this;var match;function getTab(group){var tab=group.match(/\n(\s+)/);if(tab!==null){return new RegExp("\\n("+tab[1]+")","g")}return false}function add(index,name){var tab=getTab(groups[index]);var obj={};if(/:/.test(name)){throw'Peach illegal: ":" in template name "'+name+'"'}obj[name]={value:groups[index].replace(/\s+$/,"")};if(tab){obj[name].value=obj[name].value.replace(tab,function(m,t,index){if(index>0){return"\n"}else{return""}})}else{obj[name].value=obj[name].value.trim()}_this.add(obj)}groups.splice(0,1);for(var i=0;i<names.length;i++){add(i,names[i])}}function object(){for(var k in arg){if(typeof this._protected.store[k]!=="undefined"){throw Peach.exception('Cannot add template "'+k+'", this template already exists.')}this._protected.store[k]=arg[k]}}if(typeof arg==="string"){string.call(this)}else if(typeof arg==="object"){object.call(this)}else if(typeof arg==="undefined"){throw"Peach.fn.add requires either a string or an object as an argument."}};Peach.fn.bind=function(name,node){var array=this._protected.dataBinding[name];_.remove(array,function(_node_){return!document.body.contains(_node_)});if(Array.isArray(array)){if(array.indexOf(node)===-1){array.push(node)}}else{this._protected.dataBinding[name]=[node]}};Peach.fn.compose=function(target,prototype){function addTo(k,_target,_prototype){return function(){return _prototype[k].apply(_target,arguments)}}function compose(_target,_prototype){var valid=_target!==null&&typeof _target==="object"&&typeof _target.jquery==="undefined";if(valid){for(var k in _prototype){_target[k]=addTo(k,_target,_prototype);compose(_target[k],_prototype[k])}}return _target}return compose(target,prototype)};Peach.fn.emit=function(emitter,_arguments){var args=Array.prototype.slice.call(arguments,2,arguments.length);var n;function emit(composed){if(Array.isArray(emitter[composed])){for(var i=0,n=emitter[composed].length;i<n;i++){emitter[composed][i].apply(_arguments.object,args)}}}if(Array.isArray(_arguments.caller)){for(n=_arguments.caller.length;n>1;n--){emit(_arguments.name+":"+_arguments.caller.slice(0,n).join(":"))}for(n=_arguments.caller.length-1;n>=0;n--){emit(_arguments.name+":"+_arguments.caller[n])}if(_arguments.caller.length>1){emit([_arguments.name].concat(_arguments.caller).join(":"))}}emit(_arguments.name)};(function(window){function isObject(_arguments){var self=this;var keys=_.keys(this._protected.attr);var unsafe=["self","attr","string","class","style"].concat(keys);function extend(to,from){if(from!==window){for(var k in from){if(unsafe.indexOf(k)<0&&typeof to[k]==="undefined"&&k[0]!=="_"){to[k]=from[k]}}}}function replaceTemplate(node){var _newArguments=Peach.getArguments.call(self,node);if(Array.isArray(_newArguments.object)){for(var i=0;i<_newArguments.object.length;i++){extend(_newArguments.object[i],_arguments.object)}}else{extend(_newArguments.object,_arguments.object)}return Peach.fn.render.call(self,_newArguments)}function replaceKey(match){var type=typeof _arguments.object[match];function objectRef(){var local=_.get(_arguments.object,match);if(typeof local!=="undefined"){return local}return _.get(self._protected.model,match)}function ref(){if(["string","number"].indexOf(type)>-1){return replaceVariables(_arguments.object[match].toString())}else{return""}}if(typeof onVar==="function"){match=onVar.call(_arguments.object,match);type=typeof match;if(type==="undefined"){throw onVarError}return match}else if(match.indexOf(".")>-1){return objectRef()}else{return ref()}}function replaceVariables(string){string=string.replace(self._protected.variable,function(n,match){return replaceKey(match)});string=string.replace(self._protected.template,function(n,node){return replaceTemplate(node)});string=string.replace(self._protected.variable,function(n,match){return replaceKey(match)});return string}return replaceVariables(_arguments.object.string)}function isArray(_arguments){var each=[];for(var i=0;i<_arguments.object.length;i++){each.push(Peach.fn.fill(_arguments.object[i]))}return each.join("")}Peach.fn.fill=function(_arguments){_arguments=Peach.getArguments.apply(this,arguments);if(Array.isArray(_arguments.object)){return isArray.call(this,_arguments)}else{return isObject.call(this,_arguments)}}})(window);Peach.fn.find=function(match){var matches={};if(typeof match.test==="function"){for(var key in this._protected.store){if(match.test(key)){matches[key]=this._protected.store[key]}}return matches}else{throw Peach.exception("Required a regular expression to find matches")}return false};Peach.fn.get=function(){var a=Array.prototype.slice.call(arguments);var r=this._protected.model;return Peach.get.apply(this,[r].concat(a))};Peach.fn.getParent=function(objectName,length){length=typeof length==="undefined"?1:length;objectName=objectName.split(".");objectName=objectName.slice(0,objectName.length-length);return this.get(objectName.join("."))};(function(){function request(file,callback){var newRequest=new XMLHttpRequest;newRequest.open("get",file,true);newRequest.send();newRequest.addEventListener("error",function(){callback.apply(this,arguments)});newRequest.addEventListener("load",function(){callback(newRequest.response)})}function getContent(fileList,completeCallback){function get(i){request(fileList[i],function(fileContent){fileList[i]=fileContent;if(i<fileList.length-1){get(i+1)}else{completeCallback(fileList.join("\n"),(new Date).getTime())}})}get(0)}Peach.fn.load=function(fileList,callback){var add=this.add;var loop=this.loop;var startTime=(new Date).getTime();var nodeList=document.querySelectorAll(this._protected.tagName);getContent([].concat(fileList),function(string,endTime){var renderTime=(endTime-startTime)/1e3;console.log("* Peach render time: "+renderTime+"s");add(string);loop(nodeList,callback)})}})();(function(){function replace(oldNode){function init(node){if(typeof node==="object"&&node.nodeType===1){oldNode.parentNode.insertBefore(node,oldNode)}}return{"with":function(newNode){if(typeof newNode==="undefined"){throw Peach.exception('The rendering of "'+oldNode.getAttribute("render")+'" failed because the template did not return valid HTML')}else if(typeof newNode.length==="number"){_.forEach(newNode,init)}else{init(newNode)}oldNode.parentNode.removeChild(oldNode);return newNode}}}Peach.fn.loop=function(nodeList,callback){var self=this;var nodeArray=Array.prototype.slice.call(nodeList);_.forEach(nodeArray,function(node){replace(node).with(Peach.fn.node.call(self,node.getAttribute("render")))});if(typeof callback==="function"){callback(nodeArray)}}})();(function(Peach){function getNodeList(render){var div=document.createElement("div");div.innerHTML=render;return div.children.length>1?Array.prototype.slice.call(div.children):div.children[0]}Peach.fn.node=function(){var _arguments=Peach.getArguments.apply(this,arguments);var nodeList=getNodeList(this.render(_arguments));this.emit(this._protected.on.node,_arguments,nodeList,_arguments.caller);return nodeList}})(Peach);(function(Peach){function getNodeList(render){var div=document.createElement("div");div.innerHTML=render;return Array.prototype.slice.call(div.children)}Peach.fn.nodeEach=function(){var _arguments=Peach.getArguments.apply(this,arguments);var nodeList=getNodeList(this.renderEach(_arguments));var self=this;_.forEach(nodeList,function(node){self.emit(self._protected.on.node,_arguments,node)});return nodeList}})(Peach);Peach.fn.objectIsEmpty=function(object){for(var k in object){if(object.hasOwnProperty(k)){return true}}return false};Peach.fn.on=function(_event_,name,callback){if(typeof this._protected.on[_event_][name]==="undefined"){this._protected.on[_event_][name]=[]}this._protected.on[_event_][name].push(callback)};Peach.fn.off=function(_event_,name){this._protected.on[_event_][name]=[]};Peach.fn.render=function(_arguments){_arguments=Peach.getArguments.apply(this,arguments);if(Array.isArray(_arguments.object)){throw Peach.exception('Peach.fn.render of "'+_arguments.name+'" failed. An array was passed as an argument, instead of an object. Use "Peach.fn.renderEach" instead.')}Peach.fn.emit.call(this,this._protected.on.render,_arguments,_arguments.caller);Peach.setAttr.call(this,_arguments.object);return Peach.fn.fill.call(this,_arguments)};(function(){function augment(i,n,object,name){object.index=i;object.length=n;if(typeof object.class==="undefined"){object.class=[]}else if(typeof object.class==="string"){object.class=object.class.split(" ")}if(i%2){object.class.push(name+"--even")}else{object.class.push(name+"--odd")}if(i===0&&n===1){object.class.push(name+"--first-and-last")}else if(i===0){object.class.push(name+"--first")}else if(i>0&&i<n-1){object.class.push(name+"--member")}else{object.class.push(name+"--last")}return object}Peach.fn.renderEach=function(_arguments){var each=[];var _arguments=Peach.getArguments.apply(this,arguments);if(!Array.isArray(_arguments.object)){throw Peach.exception('Peach.fn.renderEach of "'+_arguments.name+'" failed. An array is required as an argument, not a type of: '+typeof _arguments.object+".")}for(var i=0,n=_arguments.object.length;i<n;i++){each.push(Peach.fn.render.call(this,{name:_arguments.name,caller:_arguments.caller,object:augment(i,n,_arguments.object[i],_arguments.name)}))}return each.join("\n")}})();Peach.fn.set=function(){return Peach.set.apply(this,[this._protected.model].concat(Array.prototype.slice.call(arguments)))};Peach.fn.store=function(string){var store=this._protected.store[string];if(typeof store==="object"){return store.value}else{return false}};Peach.fn.tools.addClass=function(options){var className;for(var i=1,len=arguments.length;i<len;i++){className=Peach.fn.tools.template.call(this,arguments[i],options);if(options.class.lastIndexOf(className)<0){options.class.push(className)}}};(function(){var vendor=["Moz","webkit","ms","o"];var prefixMatch=["transform","userSelect","linearGradient"];function toDomName(property){return property.replace(/(?:(Moz|webkit|ms|o)([A-Z][a-zA-Z]+)|([a-zA-Z]+))/,function(){if(typeof arguments[1]==="undefined"){return _.kebabCase(arguments[0])}return"-"+arguments[1].toLowerCase()+"-"+_.kebabCase(arguments[2])})}function prefix(styles,name){var match=prefixMatch[prefixMatch.indexOf(name)];var temp;if(typeof match==="string"){if(typeof styles[match]==="string"){return toDomName(match)}for(var i=0,n=vendor.length;i<n;i++){temp=vendor[i]+match[0].toUpperCase()+match.substring(1,match.length);if(typeof styles[temp]==="string"){return toDomName(temp)}}}return toDomName(name)}function toType(s){return/^[0-9\.]+$/.test(s)?s+="px":s}function format(styles,styleObject){var newStyle={};for(var name in styleObject){if(typeof styleObject[name]!=="undefined"){newStyle[prefix(styles,name)]=toType(styleObject[name])}}return newStyle}function stringStyleToObject(style){var styleObj={};style=style.split(";");for(var i=0,n=style.length;i<n;i++){if(/:/.test(style[i])){styleObj[style[i].split(":")[0].trim()]=style[i].split(":")[1].trim()}}return styleObj}Peach.fn.tools.css=function(options,styleObject){var self=this;if(typeof options.style==="undefined"){options.style={}}else if(typeof options.style==="string"){options.style=stringStyleToObject(options.style)}_.assign(options.style,format(self.styles,styleObject))}})();Peach.fn.tools.hasClass=function(options,classMatch){if(typeof classMatch.test==="function"){return classMatch.test(options.class.join(" "))}return options.class.indexOf(classMatch)>-1};Peach.fn.tools.removeClass=function(options){var classNames=Array.prototype.slice.call(arguments,1,arguments.length);var index;function removeRegExp(regexp){for(var i=0,n=options.class.length;i<n;i++){if(regexp.test(options.class[i])){options.class.splice(i,1)}}}for(var i=0,n=classNames.length;i<n;i++){index=options.class.indexOf(classNames[i]);if(typeof classNames[i]==="string"&&index>-1){classNames[i]=Peach.fn.tools.template.call(this,classNames[i],self);options.class.splice(options.class.indexOf(classNames[i]),1)}else if(typeof classNames[i].test==="function"){removeRegExp(classNames[i])}}return options.class};Peach.fn.tools.template=function(string,options){return string.replace(this._protected.variable,function(m,key){if(options.hasOwnProperty(key)){return options[key]}else{return""}})};Peach.fn.update=function(name,object){var dataBinding=this._protected.dataBinding;var nodeList=_.uniq(dataBinding[name].sort(function(a,b){if(a===b){return 1}return-1}),true);var newList=[];var self=this;for(var i=0,n=nodeList.length;i<n;i++){if(document.body.contains(nodeList[i])){newList.push(nodeList[i])}}dataBinding[name]=newList;_.forEach(dataBinding[name],function(oldNode,i){var newNode=peach.node(name,object);oldNode.parentNode.replaceChild(newNode,oldNode);self.bind(name,newNode)});return dataBinding[name]};
//# sourceMappingURL=peach.min.js.map